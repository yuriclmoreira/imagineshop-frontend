import { useContext, useEffect, useState } from "react";
import Head from "next/head";
import { faX } from '@fortawesome/free-solid-svg-icons';
import { ShoppingCartContext } from "@/contexts/ShoppingCartContext";
import { IProduct } from "@/types";
import Image from "next/image";
import { Button, ButtonContainer, DeleteIcon, InputGroup, LoginTitle, Main, PaymentShipping, PaymentTitle, PaymentTotal, PaymentValue, Product, ProductName, ProductPrice, Separator, ShoppingCartContainer, ShoppingCartPayment, SubTitle, Title } from "./styles";


export default function ShoppingCart() {
    const {
        getProducts,
        deleteProduct,
        getTotalProducts,
        getTotalValue,
        getShippingValue } = useContext(ShoppingCartContext);
    const [products, setProduts] = useState<IProduct[]>([]);
    const [refresh, setRefresh] = useState<number>(0);
    useEffect(() => {
        const values = getProducts();
        setProduts(values)
    }, [refresh])

    const handleDeleteProduct = (id: string) => {
        deleteProduct(id);
        setRefresh(oldValue => oldValue + 1)
    }
    return (products && products.length > 0 ? (
        <>
            <Head>
                <title>ImagineShop - Cart</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/logo.ico" />
            </Head>
            <Main>
                <Title>Meu carrinho</Title>
                <SubTitle>Produtos</SubTitle>
                <ShoppingCartContainer>
                    <section>
                        {
                            products && products.map(product => (
                                <div key={product._id}>
                                    <Separator />
                                    <ButtonContainer>
                                        <button onClick={() => handleDeleteProduct(product._id)}>

                                            <DeleteIcon icon={faX}></DeleteIcon>
                                        </button>
                                    </ButtonContainer>
                                    <Product>
                                        <div>
                                            <Image src={product.image} width={180} height={180} alt={product.name} />
                                        </div>
                                        <ProductName>{product.name}</ProductName>
                                        <ProductPrice>{product.formattedPrice}</ProductPrice>
                                    </Product>

                                </div>
                            ))
                        }
                    </section>
                    <section>
                        <ShoppingCartPayment>
                            <PaymentTitle>Resumo do pedido</PaymentTitle>
                            <PaymentValue><span>{products.length} Produtos</span> <span>{getTotalProducts()}</span></PaymentValue>
                            <PaymentShipping><span>Frete</span> <span>{getShippingValue()}</span></PaymentShipping>

                            <PaymentTotal><span>Total</span> <span>{getTotalValue()}</span></PaymentTotal>
                            <Separator />
                            <LoginTitle>Login</LoginTitle>
                            <InputGroup>
                                <span>E-mail:</span>
                                <input type="text" />
                            </InputGroup>
                            <InputGroup>
                                <span>Senha:</span>
                                <input type="password" />
                            </InputGroup>
                            <Button>
                                Continuar
                            </Button>
                        </ShoppingCartPayment>
                    </section>
                </ShoppingCartContainer>
            </Main>
        </>
    ) : (
        <>
            <Head>
                <title>ImagineShop - Cart</title>
                <meta name="description" content="Generated by create next app" />
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/logo.ico" />
            </Head>
            <Main>
                Sem produto
            </Main>
        </>
    ))
}